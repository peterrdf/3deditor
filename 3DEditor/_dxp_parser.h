#pragma once


#include <algorithm> 
#include <functional> 
#include <cctype>
#include <locale>

#include <iostream>
#include <fstream>

#include <vector>
#include <string>
#include <map>

using namespace std;

namespace _dxf
{
	// --------------------------------------------------------------------------------------------
	// _error
	// --------------------------------------------------------------------------------------------
	class _error : public runtime_error
	{

	public: // Members		

		// ----------------------------------------------------------------------------------------
		static const string file_not_found;
		static const string invalid_argument;
		static const string sof;
		static const string eof;
		static const string invalid_format;		

	public: // Methods

		// ----------------------------------------------------------------------------------------
		_error(const string& error);
	};
	// _error
	// --------------------------------------------------------------------------------------------

	// --------------------------------------------------------------------------------------------
	// _group_codes
	// --------------------------------------------------------------------------------------------
	class _group_codes
	{

	public: // Members

		// ----------------------------------------------------------------------------------------
		static const string start;
		static const string name;
		static const string eof;
		static const string section;
		static const string endsec;
		static const string entities;
		static const string line;		
		static const string start_point_x;
		static const string start_point_y;
		static const string start_point_z;
		static const string end_point_x;
		static const string end_point_y;
		static const string end_point_z;
	};
	// _group_codes
	// --------------------------------------------------------------------------------------------

	// --------------------------------------------------------------------------------------------
	// _reader	
	// --------------------------------------------------------------------------------------------
	class _reader
	{

	private: // Members

		// ----------------------------------------------------------------------------------------
		// .dxf file
		ifstream& m_dxfFile;

		// ----------------------------------------------------------------------------------------
		// all rows
		vector<string> m_vecRows;

		// ----------------------------------------------------------------------------------------
		// current row
		size_t m_iRow;

	public: // Methods

		// ----------------------------------------------------------------------------------------
		_reader(ifstream&);

		// ----------------------------------------------------------------------------------------
		virtual ~_reader();		

		// ----------------------------------------------------------------------------------------
		void load();

		// ----------------------------------------------------------------------------------------
		const vector<string>& rows() const;

		// ----------------------------------------------------------------------------------------
		size_t rowIndex() const;

		// ----------------------------------------------------------------------------------------
		const string& row();

		// ----------------------------------------------------------------------------------------
		const string& forth();

		// ----------------------------------------------------------------------------------------
		const string& back();
	};
	// _reader
	// --------------------------------------------------------------------------------------------

	// --------------------------------------------------------------------------------------------
	// _group
	// --------------------------------------------------------------------------------------------
	class _group
	{

	private: // Members

		// ----------------------------------------------------------------------------------------
		string m_strName;

	public: // Methods

		// ----------------------------------------------------------------------------------------
		_group(const string& strName);

		// ----------------------------------------------------------------------------------------
		virtual ~_group();

		// ----------------------------------------------------------------------------------------
		const string& name() const;
	};
	// _group
	// --------------------------------------------------------------------------------------------

	// --------------------------------------------------------------------------------------------
	// _entity
	// --------------------------------------------------------------------------------------------
	class _entity : public _group
	{

	protected: //  Members

		// ----------------------------------------------------------------------------------------
		map<string, string> m_mapCode2Value;

	public: //  Members
		 
		// ----------------------------------------------------------------------------------------
		static const string subclass_code;
		static const string layer_code;

	public: // Methods

		// ----------------------------------------------------------------------------------------
		_entity(const string& strName);

		// ----------------------------------------------------------------------------------------
		virtual ~_entity();		

		// ----------------------------------------------------------------------------------------
		virtual void load(_reader& reader);

		// ----------------------------------------------------------------------------------------
		const string& layer();

		// ----------------------------------------------------------------------------------------
		virtual int64_t createInstance(int64_t iModel) = 0;	
	};
	// _entity
	// --------------------------------------------------------------------------------------------

	// --------------------------------------------------------------------------------------------
	// _section
	// --------------------------------------------------------------------------------------------
	class _section : public _group
	{

	public: // Methods

		// ----------------------------------------------------------------------------------------
		_section(const string& strName);

		// ----------------------------------------------------------------------------------------
		virtual ~_section();
	};
	// _section
	// --------------------------------------------------------------------------------------------

	// --------------------------------------------------------------------------------------------
	// _entities_section
	// --------------------------------------------------------------------------------------------
	class _entities_section : public _section
	{

	private: // Members

		// ----------------------------------------------------------------------------------------
		vector<_entity*> m_vecEntities;

	public: // Methods

		// ----------------------------------------------------------------------------------------
		_entities_section();

		// ----------------------------------------------------------------------------------------
		virtual ~_entities_section();

		// ----------------------------------------------------------------------------------------
		const vector<_entity*>& entities() const;

		// ----------------------------------------------------------------------------------------
		void load(_reader& reader);		
	};
	// _entities_section
	// --------------------------------------------------------------------------------------------

	// --------------------------------------------------------------------------------------------
	// _line
	// --------------------------------------------------------------------------------------------
	class _line : public _entity
	{

	public: // Methods

		// ----------------------------------------------------------------------------------------
		_line();

		// ----------------------------------------------------------------------------------------
		virtual ~_line();

		// ----------------------------------------------------------------------------------------
		virtual int64_t createInstance(int64_t iModel);
	};
	// _line
	// --------------------------------------------------------------------------------------------

	// --------------------------------------------------------------------------------------------
	// _parser
	// --------------------------------------------------------------------------------------------
	class _parser
	{

	private: // Members

		// ----------------------------------------------------------------------------------------
		int64_t m_iModel;

		// ----------------------------------------------------------------------------------------
		vector<_section*> m_vecSections;

	public: // Methods

		// ----------------------------------------------------------------------------------------
		_parser(int64_t iModel);

		// ----------------------------------------------------------------------------------------
		virtual ~_parser();

		// ----------------------------------------------------------------------------------------
		void load(const wchar_t* szFile);

	private: // Methods

		// ----------------------------------------------------------------------------------------
		void createInstances();
	};
	// _parser
	// --------------------------------------------------------------------------------------------
};

